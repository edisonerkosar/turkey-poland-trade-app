import streamlit as st
import pandas as pd
import plotly.express as px

st.title("Turkey → Poland Trade Explorer (2013–2024)")

@st.cache_data
def load_data():
    return pd.read_excel("trade_master_all_levels.xlsx")

df = load_data()

st.sidebar.header("Search Options")

search = st.sidebar.text_input("Enter HS code (2, 4 or 6 digits)")

level = st.sidebar.selectbox(
    "Aggregation Level",
    ["HS6", "HS4", "HS2"]
)

# Filter by HS code
if search:
    filtered = df[df[level].astype(str).str.startswith(search)]
else:
    filtered = df

# Aggregate dynamically
grouped = filtered.groupby(["Year", level], as_index=False)["Final_FOB_Value"].sum()

st.write("Filtered Data Preview", grouped.head(20))

fig = px.line(
    grouped,
    x="Year",
    y="Final_FOB_Value",
    color=level,
    title=f"Trade Value by {level}"
)

st.plotly_chart(fig)

st.write("Total Value Displayed:", grouped["Final_FOB_Value"].sum())
